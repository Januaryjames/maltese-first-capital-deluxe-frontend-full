<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Client Dashboard — Maltese First Capital</title>
  <link rel="stylesheet" href="styles.css">
  <script>const API=(window.BACKEND_URL || localStorage.getItem('BACKEND_URL') || '');</script>
</head>
<body>
<header class="site-header">
  <nav class="nav">
    <a href="index.html" class="brand"><img src="assets/logo.png" alt=""><span class="wordmark">Maltese First Capital</span></a>
    <div class="nav-actions">
      <a href="#" id="logout">Logout</a>
    </div>
  </nav>
</header>

<main class="container">
  <section class="card section">
    <h2>Accounts</h2>
    <div id="accounts" class="grid-2"></div>
  </section>

  <section class="card section">
    <h2>Recent Transactions</h2>
    <table class="table" id="txTable">
      <thead><tr><th>Date</th><th>Currency</th><th>Type</th><th>Amount</th><th>Description</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>
</main>

<footer class="site-footer">© 2025 Maltese First Capital · Valletta, Malta</footer>

<script>
const token = localStorage.getItem('CLIENT_TOKEN');
if(!token){ location.href='client-login.html'; }

document.getElementById('logout').onclick = ()=>{ localStorage.removeItem('CLIENT_TOKEN'); location.href='index.html'; };

(async ()=>{
  const r = await fetch(`${API}/api/client/overview`,{ headers:{Authorization:`Bearer ${token}`} });
  if(!r.ok){ localStorage.removeItem('CLIENT_TOKEN'); location.href='client-login.html'; return; }
  const d = await r.json();

  // accounts
  const a = document.getElementById('accounts');
  a.innerHTML = d.accounts.map(ac => `
    <div class="tile">
      <h3>${ac.currency} Account</h3>
      <p><b>Account No.:</b> ${ac.accountNumber}</p>
      <p><b>Balance:</b> ${ac.balance.toLocaleString(undefined,{minimumFractionDigits:2, maximumFractionDigits:2})}</p>
      ${ac.statementNote ? `<p><em>${ac.statementNote}</em></p>` : ''}
    </div>
  `).join('');

  // transactions
  const tb = document.querySelector('#txTable tbody');
  tb.innerHTML = d.transactions.map(t => `
    <tr>
      <td>${new Date(t.createdAt).toLocaleDateString()}</td>
      <td>${t.currency}</td>
      <td>${t.type}</td>
      <td>${(t.type==='debit'?'-':'')}${Number(t.amount).toLocaleString(undefined,{minimumFractionDigits:2, maximumFractionDigits:2})}</td>
      <td>${t.desc || ''}</td>
    </tr>
  `).join('');
})();
</script>
</body>
</html>
