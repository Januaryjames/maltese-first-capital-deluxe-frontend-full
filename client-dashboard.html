<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Client Dashboard — Maltese First Capital</title>
  <link rel="icon" href="/assets/logo-crest.png" />
  <link rel="stylesheet" href="/styles.css" />

  <!-- White header + page styles (scoped) -->
  <style>
    :root { --bg:#0b0f16; --card:#101722; --text:#e9eef8; --muted:#9eb0c7; --gold:#d4af37; --ok:#1db954; }
    html,body{ background:var(--bg); color:var(--text); margin:0; font-family:system-ui,-apple-system,Segoe UI,Inter,Roboto,sans-serif; }
    .cl-wrap{ max-width:1160px; margin:0 auto; padding:16px 20px 48px; }

    .client-header{
      background:#fff; color:#111; border-bottom:1px solid #e8edf3; padding:14px 20px;
    }
    .client-header .brand{ display:inline-flex; align-items:center; gap:10px; text-decoration:none; }
    .client-header .brand b{ color:#111; font-weight:600; letter-spacing:.2px; }
    .client-header .brand-logo{
      width:48px; height:48px; object-fit:contain; display:inline-block;
      background:transparent; filter:none !important; -webkit-filter:none !important; mix-blend-mode:normal !important;
    }
    .client-header .logout{ float:right; color:#334155; font-size:14px; text-decoration:none; margin-top:10px; }

    .cl-grid{ display:grid; grid-template-columns:1fr; gap:16px; margin-top:18px; }
    @media (min-width:980px){ .cl-grid{ grid-template-columns:1.1fr .9fr; } }

    .cl-card{ background:var(--card); border:1px solid rgba(212,175,55,.18); border-radius:16px; padding:18px; }
    .k{ color:var(--muted); font-size:13px; }
    .v{ font-weight:600; }
    .mono{ font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace; }
    .pill{ display:inline-flex; align-items:center; gap:8px; border:1px solid rgba(255,255,255,.12); padding:6px 10px; border-radius:999px; background:#0d131b; }
    .pill.ok{ border-color:#224b36; color:#bff0c8; }

    table{ width:100%; border-collapse:collapse; }
    th,td{ padding:10px; border-bottom:1px solid rgba(255,255,255,.06); text-align:left; }
    th{ color:var(--muted); font-weight:600; }
    .amt{ white-space:nowrap; }
    .pos{ color:#9bf3b3 } .neg{ color:#ff9d9d }
  </style>

  <!-- Same robust mock-store loader with fallback -->
  <script>
    (function(){
      window.__MFC_STORE_READY = new Promise(function(resolve){
        var done = false;
        function complete(){ if(!done){ done=true; resolve(); } }
        var s = document.createElement('script');
        s.src = '/scripts/mock-store.js?v=1';
        s.async = false;
        s.onload = complete;
        s.onerror = function(){
          console.warn('[MFC] mock-store.js failed to load; using inline fallback.');
          window.MFC_MOCK = {
            USERS: {
              "bejadbn1122@gmail.com": {
                password: "MFC#Bejad2025!",
                name: "Bejad Bandoor A. Alharbi",
                companyName: "Nab’ al-Khayrat For Trading"
              }
            },
            ACCOUNTS: {
              "bejadbn1122@gmail.com": {
                holder: "Nab’ al-Khayrat For Trading",
                accountNo: "91550872",
                currency: "USD",
                status: "active",
                balance: 0,
                lines: []
              }
            }
          };
          complete();
        };
        document.head.appendChild(s);
      });
    })();
  </script>
</head>
<body>
  <header class="client-header">
    <div class="cl-wrap" style="padding-bottom:0">
      <a class="brand" href="/index.html">
        <img class="brand-logo" src="/assets/logo-crest.png" alt="Maltese First Capital" />
        <b>Maltese First Capital</b>
      </a>
      <a class="logout" href="#" id="logoutLink">Logout</a>
    </div>
  </header>

  <main class="cl-wrap">
    <div class="cl-grid">
      <section class="cl-card">
        <h2 style="margin:0 0 10px">Account Overview</h2>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:14px">
          <div>
            <div class="k">Account Holder</div>
            <div class="v" id="holderName">—</div>
          </div>
          <div>
            <div class="k">Authorised Person</div>
            <div class="v" id="authPerson">—</div>
          </div>
          <div>
            <div class="k">Account Number</div>
            <div class="v mono" id="acctNo">—</div>
          </div>
          <div>
            <div class="k">Status</div>
            <div class="pill ok" id="acctStatus">active</div>
          </div>
          <div>
            <div class="k">Currency</div>
            <div class="v" id="acctCcy">USD</div>
          </div>
          <div>
            <div class="k">Current Balance</div>
            <div class="v" id="acctBal">—</div>
          </div>
        </div>
      </section>

      <section class="cl-card">
        <h2 style="margin:0 0 10px">Recent Transactions</h2>
        <div id="txBox"><div class="k">Loading…</div></div>
      </section>
    </div>
  </main>

  <script>
    (function(){
      function $(s,r){return (r||document).querySelector(s)}
      function kickToLogin(){
        var next = encodeURIComponent(location.pathname);
        location.href = '/client-login.html?next=' + next;
      }
      function fmtMoney(n,c){ return (typeof n==='number') ? n.toLocaleString(undefined,{style:'currency',currency:c||'USD'}) : '—'; }

      document.getElementById('logoutLink').addEventListener('click', function(e){
        e.preventDefault();
        localStorage.removeItem('mfc_mock_email');
        localStorage.removeItem('mfc_mock_token');
        kickToLogin();
      });

      window.__MFC_STORE_READY.then(function(){
        var email = (localStorage.getItem('mfc_mock_email')||'').toLowerCase();
        var token = localStorage.getItem('mfc_mock_token');
        if (!email || !token) { kickToLogin(); return; }
        if (!window.MFC_MOCK || !MFC_MOCK.USERS || !MFC_MOCK.ACCOUNTS) { kickToLogin(); return; }

        var user = MFC_MOCK.USERS[email];
        var acct = MFC_MOCK.ACCOUNTS[email];
        if (!user || !acct) { kickToLogin(); return; }

        $('#holderName').textContent = acct.holder || user.companyName || '—';
        $('#authPerson').textContent = user.name || (email.split('@')[0]);
        $('#acctNo').textContent     = acct.accountNo || '—';
        $('#acctStatus').textContent = acct.status || 'active';
        $('#acctCcy').textContent    = acct.currency || 'USD';
        $('#acctBal').textContent    = fmtMoney(Number(acct.balance||0), acct.currency || 'USD');

        var lines = Array.isArray(acct.lines) ? acct.lines.slice() : [];
        lines.sort(function(a,b){ return new Date(b.ts) - new Date(a.ts); });
        if (!lines.length){ $('#txBox').innerHTML = '<div class="k">No transactions yet.</div>'; return; }

        var rows = lines.slice(0,20).map(function(l){
          var sign = l.type === 'debit' ? -1 : 1;
          var cls  = sign < 0 ? 'neg' : 'pos';
          var amt  = fmtMoney(sign * Number(l.amount||0), l.currency || acct.currency || 'USD');
          var when = l.ts ? new Date(l.ts).toLocaleString() : '—';
          return '<tr><td>'+when+'</td><td>'+(l.description||l.type||'-')+'</td><td class="amt '+cls+'">'+amt+'</td></tr>';
        }).join('');

        $('#txBox').innerHTML =
          '<table><thead><tr><th>Date</th><th>Description</th><th>Amount</th></tr></thead><tbody>'+rows+'</tbody></table>';
      });
    })();
  </script>
</body>
</html>
