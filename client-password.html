<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Change Password ‚Äî Maltese First Capital</title>
  <link rel="icon" href="/assets/logo-crest.png">
  <link rel="stylesheet" href="/styles.css" />
  <style>
    :root{ --bg:#0b0f16; --ink:#0b1020; --text:#e9eef8; --muted:#99a8bf; --card:#0f1622; --line:#e6e8ec; }
    html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Inter,Roboto,sans-serif}
    .nav{position:sticky;top:0;z-index:1000;background:#fff;color:#0b1020;border-bottom:1px solid var(--line);box-shadow:0 4px 16px rgba(12,16,24,.06)}
    .nav-inner{max-width:1160px;margin:0 auto;padding:10px 20px;display:flex;align-items:center;gap:12px}
    .brand{display:flex;align-items:center;gap:12px;color:#0b1020;text-decoration:none;font-weight:800}
    .brand img{width:44px;height:44px;border-radius:10px;object-fit:contain}
    .wrap{max-width:1160px;margin:0 auto;padding:22px}
    .center{max-width:640px;margin:32px auto}
    .card{background:#0f1622;border:1px solid rgba(212,175,55,.18);border-radius:16px;padding:22px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    h1{margin:0 0 8px;font-size:22px}.k{color:var(--muted)}
    label{display:block;margin:12px 0 6px}.input-wrap{position:relative}
    input{width:100%;padding:14px 12px;border-radius:12px;border:1px solid #263246;background:#0e1521;color:#e9eef8;outline:none}
    .eye{position:absolute;right:8px;top:50%;transform:translateY(-50%);background:transparent;border:0;color:#cfd9ea;cursor:pointer;padding:6px;border-radius:8px}
    .btn{width:100%;margin-top:14px;padding:12px 14px;border-radius:12px;border:1px solid #7f6720;color:#141820;background:linear-gradient(180deg,#f0d470,#cdaa2f);font-weight:800}
    .msg{margin-top:12px;font-size:14px}.msg.error{color:#ff9d9d}.msg.ok{color:#9bf3b3}
    .row{display:flex;gap:10px;justify-content:space-between;margin-top:10px}
    .link{color:#e3e9f6;text-decoration:none;opacity:.9}.link:hover{opacity:1;text-decoration:underline}
  </style>
</head>
<body>
  <nav class="nav">
    <div class="nav-inner">
      <a class="brand" href="/index.html"><img src="/assets/logo-crest.png" alt=""><span>Maltese First Capital</span></a>
    </div>
  </nav>

  <div class="wrap">
    <div class="center">
      <div class="card">
        <h1>Change Password</h1>
        <div class="k">Update your password. You‚Äôll stay signed in after the change.</div>

        <form id="pwForm" novalidate>
          <label for="email">Email</label>
          <input id="email" name="email" type="email" required placeholder="you@company.com" />

          <label for="oldpw">Current Password</label>
          <div class="input-wrap">
            <input id="oldpw" name="oldpw" type="password" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
            <button class="eye" type="button" data-toggle="oldpw">üëÅ</button>
          </div>

          <label for="newpw">New Password</label>
          <div class="input-wrap">
            <input id="newpw" name="newpw" type="password" required placeholder="At least 8 characters" />
            <button class="eye" type="button" data-toggle="newpw">üëÅ</button>
          </div>

          <label for="confpw">Confirm New Password</label>
          <div class="input-wrap">
            <input id="confpw" name="confpw" type="password" required placeholder="Repeat new password" />
            <button class="eye" type="button" data-toggle="confpw">üëÅ</button>
          </div>

          <button id="submitBtn" class="btn" type="submit">Save Password</button>
          <div id="formMsg" class="msg" role="status" aria-live="polite"></div>

          <div class="row">
            <a class="link" href="/client-dashboard.html">Back to dashboard</a>
            <a class="link" href="/client-login.html?next=/client-dashboard.html">Log in</a>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Optional backend base for admin notification -->
  <script>
    window.__MFC_CONFIG = window.__MFC_CONFIG || {
      // If you want email notifications to ops when a client changes their password:
      // API_BASE_URL: 'https://maltese-first-capital-deluxe-backend.onrender.com'
    };
  </script>

  <!-- Mock store + change logic -->
  <script>
  (function(){
    // Same mock store as login/dashboard
    window.MFC_MOCK = window.MFC_MOCK || { USERS:{} };

    const $=(s)=>document.querySelector(s);
    const API=(window.__MFC_CONFIG?.API_BASE_URL||'').replace(/\/+$/,'');
    const msg=$("#formMsg");

    document.querySelectorAll(".eye").forEach(btn=>{
      btn.addEventListener("click",()=>{
        const id=btn.getAttribute("data-toggle"); const el=document.getElementById(id);
        const t=el.type==="password"?"text":"password"; el.type=t;
        btn.textContent = t==="password"?"üëÅ":"üôà";
      });
    });

    function say(t,ok=false){msg.textContent=t||"";msg.className="msg "+(ok?"ok":"error");}

    $("#pwForm").addEventListener("submit", async (e)=>{
      e.preventDefault(); say("");
      const email=$("#email").value.trim().toLowerCase();
      const oldpw=$("#oldpw").value;
      const newpw=$("#newpw").value;
      const conf=$("#confpw").value;

      if(!email || !oldpw || !newpw || !conf) return say("Please complete all fields.");
      if(newpw.length<8) return say("New password must be at least 8 characters.");
      if(newpw!==conf) return say("New passwords do not match.");

      const u=(window.MFC_MOCK.USERS||{})[email];
      if(!u) return say("Account not found.");
      if(String(u.password)!==String(oldpw)) return say("Current password is incorrect.");

      // Update local mock
      u.password=newpw;

      // Optional admin notify (if API configured)
      if(API){
        try{
          await fetch(API+"/api/public/password-changed",{
            method:"POST",
            headers:{ "Content-Type":"application/json" },
            body: JSON.stringify({ email, changedAt:new Date().toISOString() })
          });
        }catch(e){ /* non-fatal for mock */ }
      }

      say("Password updated.", true);
    });
  })();
  </script>
</body>
</html>
