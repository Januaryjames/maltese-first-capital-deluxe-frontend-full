<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Client Login • Maltese First Capital</title>
  <link rel="icon" href="assets/logo.png">
  <link rel="stylesheet" href="styles.css?v=21">
</head>
<body>
  <!-- NAVBAR -->
  <div class="navbar-wrap">
    <div class="container navbar">
      <a class="brand navbar-brand" href="index.html">
        <img src="assets/logo.png" alt="Maltese First Capital">
        <span>Maltese First Capital</span>
      </a>
      <nav class="links">
        <a href="private-banking.html">Private Banking</a>
        <a href="wealth-management.html">Wealth Management</a>
        <a href="about.html">About</a>
        <a href="contact.html">Contact</a>
        <a class="highlight" href="client-register.html">Open an Account</a>
      </nav>
    </div>
  </div>

  <!-- HERO -->
  <section class="hero">
    <div class="container">
      <img class="hero-logo" src="assets/logo.png" alt="MFC">
      <h1>Client Login</h1>
      <p class="lead">Enter your email to receive a one-time passcode.</p>
      <div class="container" style="max-width:560px;margin:0 auto">
        <form id="loginForm" class="card" style="background:#0f1a27;border:1px solid var(--line);border-radius:16px;padding:18px">
          <label for="email">Email</label>
          <input id="email" type="email" placeholder="you@company.com" required>
          <div class="cta-row" style="justify-content:flex-end;margin-top:12px">
            <button class="btn gold" type="submit">Send Code</button>
          </div>
          <div id="step1Note" class="muted" style="margin-top:8px"></div>
        </form>

        <form id="verifyForm" class="card" style="display:none;background:#0f1a27;border:1px solid var(--line);border-radius:16px;padding:18px;margin-top:12px">
          <label for="code">6-digit code</label>
          <input id="code" inputmode="numeric" minlength="6" maxlength="6" placeholder="123456" required>
          <div class="cta-row" style="justify-content:flex-end;margin-top:12px">
            <button class="btn gold" type="submit">Verify & Continue</button>
          </div>
          <div id="step2Note" class="muted" style="margin-top:8px"></div>
        </form>
      </div>
    </div>
  </section>

  <footer><div class="container">© 2025 Maltese First Capital — Valletta, Malta • <a href="mailto:hello@maltesefirst.com" style="color:inherit">hello@maltesefirst.com</a></div></footer>

<script>
const API = localStorage.getItem('BACKEND_URL') || '';
const f1 = document.getElementById('loginForm');
const f2 = document.getElementById('verifyForm');
const step1Note = document.getElementById('step1Note');
const step2Note = document.getElementById('step2Note');

f1.addEventListener('submit', async (e)=>{
  e.preventDefault();
  const email = document.getElementById('email').value.trim();
  step1Note.textContent = 'Sending code…';
  try{
    const r = await fetch(`${API}/api/auth/login`, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({email})});
    if(!r.ok) throw new Error(await r.text());
    step1Note.textContent = 'Code sent. Check your inbox.';
    f2.style.display='block';
    document.getElementById('code').focus();
    localStorage.setItem('CLIENT_EMAIL', email);
  }catch(err){ step1Note.textContent = 'Unable to send code.'; }
});

f2.addEventListener('submit', async (e)=>{
  e.preventDefault();
  const email = localStorage.getItem('CLIENT_EMAIL') || document.getElementById('email').value.trim();
  const code  = document.getElementById('code').value.trim();
  step2Note.textContent = 'Verifying…';
  try{
    const r = await fetch(`${API}/api/auth/verify`, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({email, code})});
    const data = await r.json();
    if(!r.ok || !data.ok) throw new Error(data.error||'Failed');
    localStorage.setItem('CLIENT_TOKEN', data.token);
    step2Note.textContent = 'Success. Redirecting…';
    location.href='client-dashboard.html';
  }catch(err){ step2Note.textContent = 'Invalid or expired code.'; }
});
</script>
</body>
</html>
