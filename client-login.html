<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Client Login ‚Äî Maltese First Capital</title>
  <link rel="icon" href="/assets/logo-crest.png">
  <link rel="stylesheet" href="/styles.css"/>
  <style>
    :root { --bg:#0b0f16; --card:#101722; --text:#e9eef8; --muted:#9eb0c7; --gold:#d4af37; }
    html,body{background:#0b0f16;color:var(--text);margin:0;font-family:system-ui,-apple-system,Segoe UI,Inter,Roboto,sans-serif}
    .wrap{max-width:980px;margin:0 auto;padding:0 16px 64px}
    .topbar{background:#fff;color:#111;border-bottom:1px solid #eee}
    .nav{display:flex;align-items:center;gap:14px;height:64px}
    .brand{display:flex;align-items:center;gap:10px;color:#111;text-decoration:none;font-weight:600}
    .brand img{width:40px;height:40px;object-fit:contain;border-radius:10px}
    .section{display:flex;justify-content:center;margin-top:56px}
    .card{width:100%;max-width:520px;background:var(--card);border:1px solid rgba(212,175,55,.18);border-radius:16px;padding:22px}
    .muted{color:var(--muted);font-size:14px}
    .field{margin-top:14px}
    .field label{display:block;margin:0 0 6px 2px;font-size:14px;color:var(--muted)}
    .input{display:flex;align-items:center;background:#121a26;border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:10px 12px}
    .input input{flex:1;background:transparent;border:0;outline:0;color:var(--text);font-size:15px}
    .row{display:flex;align-items:center;gap:10px;margin-top:10px}
    .btn{width:100%;margin-top:16px;border:0;border-radius:12px;padding:12px 14px;
         background:linear-gradient(#d4af37,#b79426);color:#121212;font-weight:600;cursor:pointer}
    .link{color:#8ab4ff;text-decoration:none}
    .error{background:#2b1313;border:1px solid #5a1e1e;color:#ffb3b3;border-radius:10px;padding:10px 12px;margin-bottom:10px;display:none}
    .show{display:block}
  </style>
</head>
<body>
  <div class="topbar">
    <div class="wrap">
      <div class="nav">
        <a class="brand" href="/index.html">
          <img src="/assets/logo-crest.png" alt="MFC">
          <span>Maltese First Capital</span>
        </a>
        <div style="margin-left:auto;color:#555;">Client Area</div>
      </div>
    </div>
  </div>

  <div class="wrap section">
    <form id="loginForm" class="card" autocomplete="off">
      <h2 style="margin:0 0 8px">Client Login</h2>
      <p class="muted" style="margin:0 0 12px">Enter your email and password to access your account.</p>

      <div id="err" class="error"></div>

      <div class="field">
        <label for="email">Email</label>
        <div class="input">
          <input id="email" name="email" type="email" inputmode="email"
                 placeholder="you@company.com"
                 autocomplete="off" autocapitalize="off" spellcheck="false" value="">
        </div>
      </div>

      <div class="field">
        <label for="password">Password</label>
        <div class="input">
          <input id="password" name="password" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                 autocomplete="new-password" spellcheck="false" value="">
          <button id="togglePw" type="button" aria-label="Show password"
                  style="background:none;border:0;color:#9eb0c7;cursor:pointer">üëÅÔ∏è</button>
        </div>
      </div>

      <div class="row">
        <label style="display:flex;align-items:center;gap:8px;font-size:14px;color:var(--muted)">
          <input id="showPw" type="checkbox"> Show password
        </label>
      </div>

      <button class="btn" type="submit">Sign in</button>

      <p class="muted" style="margin-top:10px">
        Forgot or want to change it? <a class="link" href="/change-password.html">Change password</a>
      </p>
    </form>
  </div>

  <!-- Your existing auth & store scripts -->
  <script src="/scripts/mock-store.js?v=1"></script>
  <script src="/scripts/mock-auth.js?v=1"></script>

  <script>
    (function () {
      const $ = s => document.querySelector(s);
      const emailEl = $('#email');
      const pwEl = $('#password');
      const errEl = $('#err');

      // 1) Hard stop any prefill: clear on load, and prevent autocomplete
      document.addEventListener('DOMContentLoaded', () => {
        // If the HTML or a browser tries to prefill, blank it.
        if (emailEl && emailEl.value) emailEl.value = '';
        if (pwEl && pwEl.value) pwEl.value = '';
        // Remove any ‚Äúremember me‚Äù from older versions
        try { localStorage.removeItem('mfc_last_email'); } catch {}
      });

      // 2) Toggle password visibility
      const setPwType = (show) => { pwEl.type = show ? 'text' : 'password'; };
      $('#showPw').addEventListener('change', (e)=> setPwType(e.target.checked));
      $('#togglePw').addEventListener('click', ()=> setPwType(pwEl.type === 'password'));

      // 3) Login handler (uses existing MOCK or backend if mock-auth proxies)
      $('#loginForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        errEl.classList.remove('show'); errEl.textContent = '';

        const email = (emailEl.value || '').trim().toLowerCase();
        const password = pwEl.value || '';

        if (!email || !password) {
          errEl.textContent = 'Please enter both email and password.'; errEl.classList.add('show'); return;
        }

        try {
          // mock-auth exposes window.MFC_AUTH.login(email, password)
          if (!window.MFC_AUTH || !window.MFC_AUTH.login) {
            throw new Error('Login system not loaded.');
          }
          const r = await window.MFC_AUTH.login(email, password);
          if (r && r.ok) {
            // Do NOT remember email anymore
            try { localStorage.removeItem('mfc_last_email'); } catch {}
            const next = new URLSearchParams(location.search).get('next') || '/client-dashboard.html';
            location.href = next;
          } else {
            throw new Error(r && r.error ? r.error : 'Login failed');
          }
        } catch (err) {
          errEl.textContent = (String(err.message || err) === 'Invalid credentials')
            ? 'Invalid email or password.'
            : 'Login failed. Please try again.';
          errEl.classList.add('show');
        }
      });
    })();
  </script>
</body>
</html>
