<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Client Login — Maltese First Capital</title>
  <link rel="icon" href="/assets/logo-crest.png" />
  <link rel="stylesheet" href="/styles.css" />

  <style>
    :root { --bg:#0b0f16; --panel:#0f1621; --text:#0f172a; --muted:#4d5a6b; --gold:#d4af37; }
    html,body{ background:#0b0f16; color:#e9eef8; margin:0; font-family:system-ui,-apple-system,Segoe UI,Inter,Roboto,sans-serif; }
    .cl-wrap{ max-width:1060px; margin:0 auto; padding:16px 20px 48px; }

    .client-header{ background:#fff; color:#111; border-bottom:1px solid #e8edf3; padding:14px 20px; }
    .client-header .brand{ display:inline-flex; align-items:center; gap:10px; text-decoration:none; }
    .client-header .brand b{ color:#111; font-weight:600; letter-spacing:.2px; }
    .client-header .brand-logo{ width:48px; height:48px; object-fit:contain; display:inline-block; background:transparent; }
    .client-header .tag{ float:right; color:#475569; font-size:14px; margin-top:10px; }

    .cl-card{ max-width:560px; margin:56px auto 0; background:#fff; color:#111; border:1px solid #e8edf3; border-radius:18px; box-shadow:0 10px 30px rgba(0,0,0,.25); padding:20px 22px 24px; }
    .cl-title{ font-size:26px; font-weight:800; margin:4px 0 4px; color:#0f172a; }
    .cl-sub{ color:#4d5a6b; margin:0 0 14px; line-height:1.45; }

    .cl-msg{ display:none; margin:0 0 12px; padding:10px 12px; border-radius:10px; font-size:14px; }
    .cl-msg.err{ display:block; background:#ffe9ea; color:#8a1820; border:1px solid #ffd0d4; }
    .cl-msg.ok{ display:block; background:#e7f7ee; color:#0c5132; border:1px solid #bfe4d0; }

    .cl-field{ margin:12px 0; }
    .cl-label{ display:block; font-size:13px; color:#334155; margin:0 0 6px; }
    .cl-input{ width:100%; height:44px; border-radius:12px; border:1px solid #e5e7eb; padding:0 12px; font-size:15px; background:#fff; color:#111; outline:none; }
    .cl-input:focus{ border-color:#c5a741; box-shadow:0 0 0 3px rgba(212,175,55,.25); }

    .cl-inline{ display:flex; align-items:center; gap:10px; margin:4px 0 12px; color:#475569; }
    .cl-btn{ width:100%; height:44px; border-radius:12px; border:0; cursor:pointer; background:linear-gradient(180deg, #e4c96b, #b98f28); color:#111; font-weight:700; }
    .cl-btn[disabled]{ opacity:.6; cursor:not-allowed; }
    .cl-foot{ margin-top:10px; font-size:14px; color:#4d5a6b; }
    .cl-foot a{ color:#1d4ed8; text-decoration:none; }
  </style>

  <!-- Load mock store (external, with inline fallback) -->
  <script>
    (function(){
      window.__MFC_STORE_READY = new Promise(function(resolve){
        let done = false; const complete=()=>{ if(!done){ done=true; resolve(); } };
        const s = document.createElement('script');
        s.src = '/scripts/mock-store.js?v=1'; s.async = false;
        s.onload = complete;
        s.onerror = function(){
          console.warn('[MFC] mock-store.js failed; using inline fallback.');
          window.MFC_MOCK = {
            USERS: {
              "bejadbn1122@gmail.com": {
                password: "MFC#Bejad2025!",
                name: "Bejad Bandoor A. Alharbi",
                companyName: "Nab’ al-Khayrat For Trading"
              }
            },
            ACCOUNTS: {
              "bejadbn1122@gmail.com": {
                holder: "Nab’ al-Khayrat For Trading",
                accountNo: "91550872",
                currency: "USD",
                status: "active",
                balance: 0,
                lines: []
              }
            }
          };
          complete();
        };
        document.head.appendChild(s);
      });
    })();
  </script>
</head>
<body>
  <header class="client-header">
    <div class="cl-wrap" style="padding-bottom:0">
      <a class="brand" href="/index.html">
        <img class="brand-logo" src="/assets/logo-crest.png" alt="Maltese First Capital" />
        <b>Maltese First Capital</b>
      </a>
      <span class="tag">Client Area</span>
    </div>
  </header>

  <main class="cl-wrap">
    <section class="cl-card">
      <h1 class="cl-title">Client Login</h1>
      <p class="cl-sub">Enter your email and password to access your account.</p>

      <div id="msg" class="cl-msg"></div>

      <form id="loginForm" novalidate autocomplete="off">
        <div class="cl-field">
          <label class="cl-label" for="email">Email</label>
          <input id="email" class="cl-input" type="email"
                 autocomplete="off" autocapitalize="off" spellcheck="false" value="" required />
        </div>

        <div class="cl-field">
          <label class="cl-label" for="password">Password</label>
          <input id="password" class="cl-input" type="password"
                 autocomplete="new-password" spellcheck="false" value="" required />
        </div>

        <div class="cl-inline">
          <input id="togglePass" type="checkbox" />
          <label for="togglePass">Show password</label>
        </div>

        <button id="submitBtn" class="cl-btn" type="submit">Sign in</button>

        <div class="cl-foot">
          Forgot or want to change it? <a href="/client-login.html#change-password">Change password</a>
        </div>
      </form>
    </section>
  </main>

  <!-- Inline auth used by login -->
  <script>
    window.MFC_AUTH = {
      async login(email, password) {
        if (!window.MFC_MOCK || !MFC_MOCK.USERS[email]) 
          return { ok: false, error: "No account found" };
        const u = MFC_MOCK.USERS[email];
        if (u.password !== password)
          return { ok: false, error: "Invalid credentials" };
        return { ok: true, user: u };
      }
    };
  </script>

  <script>
    (function(){
      const $ = s => document.querySelector(s);
      const msg = $('#msg'), form = $('#loginForm');
      const toggle = $('#togglePass'), emailEl = $('#email'), passEl = $('#password');
      const submit = $('#submitBtn');

      // Keep inputs empty (no autofill)
      document.addEventListener('DOMContentLoaded', ()=>{ emailEl.value=''; passEl.value=''; });

      toggle.addEventListener('change', ()=>{ passEl.type = toggle.checked ? 'text' : 'password'; });

      window.__MFC_STORE_READY.then(function(){
        form.addEventListener('submit', async function(e){
          e.preventDefault();
          msg.className='cl-msg'; msg.textContent='';
          submit.disabled = true;

          const email = (emailEl.value||'').trim().toLowerCase();
          const pass  = passEl.value;

          if (!email || !pass){
            msg.className='cl-msg err'; msg.textContent='Please enter both email and password.'; submit.disabled=false; return;
          }

          const result = await window.MFC_AUTH.login(email, pass);
          if (!result.ok){
            msg.className='cl-msg err';
            msg.textContent = result.error === 'Invalid credentials' ? 'Incorrect password.' : 'No account found for that email.';
            submit.disabled=false; return;
          }

          // ✅ Write ALL keys the dashboard might check
          const token = 'mock-' + Math.random().toString(36).slice(2);
          try{
            localStorage.setItem('mfc_token', token);
            localStorage.setItem('mfc_mock_token', token);
            localStorage.setItem('mfc_email', email);
            localStorage.setItem('mfc_mock_email', email);
          }catch(e){}

          const params = new URLSearchParams(location.search);
          const next = params.get('next') || '/client-dashboard.html';
          location.href = next;
        });
      });
    })();
  </script>
</body>
</html>
