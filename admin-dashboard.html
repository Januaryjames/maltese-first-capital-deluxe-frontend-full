<!doctype html><html lang="en"><head>
<meta charset="utf-8">
<title>Client Dashboard — Maltese First Capital</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" href="assets/logo.png">
<link rel="stylesheet" href="styles.css">
</head><body>

<header class="site-header"><div class="container nav">
  <a class="brand" href="index.html"><img src="assets/logo.png" alt=""><span>Maltese First Capital</span></a>
  <nav class="nav-links"><a href="private-banking.html">Private Banking</a><a href="wealth-management.html">Wealth Management</a><a href="about.html">About</a><a href="contact.html">Contact</a></nav>
  <div class="nav-actions" id="navActions"><a class="btn btn-secondary" href="client-login.html" onclick="localStorage.removeItem('CLIENT_TOKEN')">Sign out</a></div>
  <button class="mobile-toggle" onclick="document.getElementById('navActions').classList.toggle('show')">☰</button>
</div></header>

<section class="section"><div class="container">
  <h2>Your Accounts</h2>
  <div id="accounts" class="content">Loading…</div>

  <h3 class="mt-32">Transactions</h3>
  <div class="content">
    <table class="table" id="tx"><thead>
      <tr><th>Date</th><th>Description</th><th>Amount</th><th>Currency</th><th>Type</th></tr>
    </thead><tbody></tbody></table>
  </div>
</div></section>

<footer class="site-footer"><div class="container inner">
  <div>© 2025 Maltese First Capital · Valletta, Malta</div>
  <div class="legal"><a href="private-banking.html">Private Banking</a> · <a href="wealth-management.html">Wealth Management</a> · <a href="about.html">About</a> · <a href="contact.html">Contact</a></div>
</div></footer>

<script>
  const API_BASE = localStorage.getItem('BACKEND_URL') || '';
  (async function(){
    try{
      const token = localStorage.getItem('CLIENT_TOKEN') || '';
      const h = { headers: { Authorization:`Bearer ${token}` } };

      const me = await fetch(`${API_BASE}/api/user/me`, h);
      const u = me.ok ? await me.json() : null;
      document.getElementById('accounts').innerHTML = u
        ? `<div><b>${u.fullName}</b><br>
            Account: ${u.accountNumber || '-'}<br>
            Balance: ${(typeof u.balance==='number'?u.balance.toFixed(2):u.balance)} ${u.baseCurrency||''}<br>
            <div class="mt-24">${(u.statementNotes||'').replace(/</g,'&lt;')}</div>
           </div>`
        : 'Unable to load account.';

      const t = await fetch(`${API_BASE}/api/user/transactions`, h);
      const rows = t.ok ? await t.json() : [];
      const tbody = document.querySelector('#tx tbody'); tbody.innerHTML='';
      (rows||[]).forEach(r=>{
        const tr=document.createElement('tr');
        const amt = (typeof r.amount === 'number') ? r.amount.toFixed(2) : r.amount;
        tr.innerHTML=`<td>${new Date(r.createdAt).toLocaleDateString()}</td>
                      <td>${(r.description||'').replace(/</g,'&lt;')}</td>
                      <td>${amt}</td><td>${r.currency||''}</td><td>${r.type||''}</td>`;
        tbody.appendChild(tr);
      });
    }catch{
      document.getElementById('accounts').textContent='Unable to load accounts.';
    }
  })();
</script>
</body></html>
